# CUTRIX è£å‰ªè½¦é—´ç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Go + React Web çš„ç°ä»£åŒ–è£å‰ªè½¦é—´ç®¡ç†ç³»ç»Ÿï¼Œå®ç°äº†ä»ç”Ÿäº§è®¡åˆ’ä¸‹è¾¾åˆ°è£å‰ªæ‰“åŒ…å®Œæˆçš„å…¨æµç¨‹æ•°å­—åŒ–è¿½è¸ªã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

ç³»ç»Ÿå›´ç»•**è®¡åˆ’ä¸æ‰§è¡Œåˆ†ç¦»**çš„æ ¸å¿ƒåŸåˆ™è®¾è®¡ï¼Œç¡®ä¿æ•°æ®çš„æ¸…æ™°ä¸å‡†ç¡®ã€‚

- **è®¡åˆ’å±‚ (`Production_Tasks`)**: ç®¡ç†å±‚ä¸‹è¾¾çš„ç”Ÿäº§æŒ‡ä»¤ï¼Œå®šä¹‰äº†â€œåº”è¯¥åšä»€ä¹ˆâ€ã€‚
- **æ‰§è¡Œå±‚ (`Production_Logs`)**: å·¥äººå®é™…æ“ä½œçš„è®°å½•ï¼Œæ˜¯â€œå®é™…å‘ç”Ÿäº†ä»€ä¹ˆâ€çš„å”¯ä¸€çœŸå®æ¥æºã€‚


### åç«¯ (Backend)
- **è¯­è¨€**: Go 1.24+
- **Webæ¡†æ¶**: Gin
- **æ•°æ®åº“**: PostgreSQL 15
- **æ•°æ®åº“é©±åŠ¨**: pgx + sqlx
- **é…ç½®ç®¡ç†**: Viper
- **å®¹å™¨åŒ–**: Docker

### å‰ç«¯ (Frontend)
- **æ¡†æ¶**: React 18 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶åº“**: Ant Design
- **çŠ¶æ€ç®¡ç†**: Zustand
- **ç½‘ç»œè¯·æ±‚**: Axios
- **è·¯ç”±**: React Router Dom

### éƒ¨ç½²æ–¹æ¡ˆ
- **å¼€å‘ç¯å¢ƒ**: Docker Compose + å‰ç«¯å¼€å‘æœåŠ¡å™¨
- **ç”Ÿäº§ç¯å¢ƒ**: Go åç«¯ç›´æ¥æ‰˜ç®¡é™æ€æ–‡ä»¶
- **æ•°æ®åº“**: PostgreSQL 15 å®¹å™¨åŒ–éƒ¨ç½²

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- Docker & Docker Compose
- Git

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <your-repo-url>
   cd CUTRIX
   ```

2. **ä¸€é”®æ„å»ºå’Œå¯åŠ¨**
   
   **Windows:**
   ```cmd
   build.bat
   ```
   
   **Linux/macOS:**
   ```bash
   chmod +x build.sh
   ./build.sh
   ```

3. **è®¿é—®åº”ç”¨**
   - åº”ç”¨åœ°å€: http://localhost:8080
   - API å¥åº·æ£€æŸ¥: http://localhost:8080/health

### å¼€å‘æ¨¡å¼
å¦‚æœéœ€è¦åŒæ—¶å¼€å‘å‰åç«¯ï¼Œæ¨èä½¿ç”¨å¼€å‘æ¨¡å¼ï¼Œæ”¯æŒçƒ­é‡è½½ã€‚

Windows: build.bat dev
Linux/macOS: ./build.sh dev

å‰ç«¯å¼€å‘æœåŠ¡å™¨: http://localhost:3000

åç«¯ API: http://localhost:8080


### æ•°æ®åº“ç®¡ç†
æˆ‘ä»¬æä¾›äº†ä¾¿æ·çš„æ•°æ®åº“ç®¡ç†è„šæœ¬ db.bat (Windows) å’Œ db.sh (Linux/macOS)ã€‚

Bash

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€ã€è¡¨ç»“æ„å’Œæ•°æ®ç»Ÿè®¡
./db.sh status

# è¿æ¥åˆ° psql å‘½ä»¤è¡Œ
./db.sh connect

# é‡ç½®æ•°æ®åº“ (æ¸…ç©ºæ‰€æœ‰æ•°æ®å¹¶ä¿ç•™ç»“æ„)
./db.sh reset

# æ’å…¥é¢„è®¾çš„æµ‹è¯•æ•°æ®
./db.sh seed


## ğŸ“ é¡¹ç›®ç»“æ„

```
CUTRIX/
â”œâ”€â”€ backend/                 # Go åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ cmd/main.go         # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ internal/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ handlers/       # HTTP å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ fabric_log_worker_handlers.go  # å¸ƒåŒ¹/æ—¥å¿—/å‘˜å·¥å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ order_handler.go              # è®¢å•å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ style_handler.go              # æ¬¾å·å¤„ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ task_handler.go               # ä»»åŠ¡å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ fabric_log_worker_services.go # å¸ƒåŒ¹/æ—¥å¿—/å‘˜å·¥æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ order_service.go              # è®¢å•æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ style_service.go              # æ¬¾å·æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ task_service.go               # ä»»åŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ repositories/   # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ pkg/               # å…¬å…±åŒ…
â”‚   â”‚   â”œâ”€â”€ database/      # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ middleware/    # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ migrations/        # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ web/              # é™æ€æ–‡ä»¶ç›®å½•ï¼ˆæ„å»ºæ—¶åˆ›å»ºï¼‰
â”œâ”€â”€ web-frontend/          # React Web å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/    # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/      # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ store/         # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ types/         # TypeScript ç±»å‹
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ docker-compose.yml     # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ build.sh / build.bat   # æ„å»ºè„šæœ¬
â””â”€â”€ README.md
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æ„å»ºå¹¶å¯åŠ¨æ•´ä¸ªåº”ç”¨
npm run build

# å¼€å‘æ¨¡å¼ï¼ˆå‰åç«¯åŒæ—¶å¯åŠ¨ï¼‰
npm run dev

# åªå¯åŠ¨åç«¯
npm run dev:backend

# åªå¯åŠ¨å‰ç«¯
npm run dev:frontend

# å¯åŠ¨ Docker æœåŠ¡
npm run docker:up

# åœæ­¢ Docker æœåŠ¡
npm run docker:down

# æŸ¥çœ‹åç«¯æ—¥å¿—
npm run docker:logs

# æ¸…ç†æ„å»ºæ–‡ä»¶
npm run clean
```

## ğŸ“Š æ ¸å¿ƒåŠŸèƒ½

### å·²å®ç°
- âœ… **æ¬¾å·ç®¡ç†** - åˆ›å»ºå’ŒæŸ¥çœ‹æ¬¾å·
- âœ… **ç”Ÿäº§ä»»åŠ¡ç®¡ç†** - åˆ›å»ºä»»åŠ¡ï¼Œå®æ—¶è¿›åº¦è¿½è¸ª
- âœ… **æ•°æ®åº“è§¦å‘å™¨** - è‡ªåŠ¨æ›´æ–°å®Œæˆå±‚æ•°
- âœ… **é™æ€æ–‡ä»¶æ‰˜ç®¡** - Go åç«¯ç›´æ¥æœåŠ¡å‰ç«¯
- âœ… **å“åº”å¼ UI** - åŸºäº Ant Design çš„ç°ä»£ç•Œé¢

### å¼€å‘ä¸­
- ğŸš§ **å¸ƒåŒ¹ç®¡ç†** - å¸ƒåŒ¹æ³¨å†Œå’ŒçŠ¶æ€è¿½è¸ª
- ğŸš§ **ç”Ÿäº§è®°å½•** - è¯¦ç»†çš„æ“ä½œæ—¥å¿—
- ğŸš§ **å‘˜å·¥ç®¡ç†** - å‘˜å·¥ä¿¡æ¯å’Œä»»åŠ¡åˆ†é…

## ğŸ”„ å‡çº§è·¯å¾„ - ä»å½“å‰æ¶æ„åˆ°é«˜æ€§èƒ½æ¶æ„

å½“ä¸šåŠ¡å‘å±•åˆ°éœ€è¦æ›´é«˜æ€§èƒ½æ—¶ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹è·¯å¾„å‡çº§ï¼š

### ç¬¬ä¸€é˜¶æ®µï¼šå½“å‰æ¶æ„ï¼ˆé€‚åˆæ—¥è®¿é—®é‡ < 10ä¸‡ï¼‰
```
æµè§ˆå™¨ â†’ Go åç«¯ (8080) â†’ PostgreSQL
         â”œâ”€â”€ /api/*  â†’ REST API  
         â””â”€â”€ /*      â†’ é™æ€æ–‡ä»¶
```

**ä¼˜åŠ¿**: éƒ¨ç½²ç®€å•ã€ç»´æŠ¤æˆæœ¬ä½
**é€‚ç”¨**: ä¸­å°å‹å›¢é˜Ÿã€å¿«é€ŸåŸå‹

### ç¬¬äºŒé˜¶æ®µï¼šç‹¬ç«‹ Web æœåŠ¡å™¨ï¼ˆé€‚åˆæ—¥è®¿é—®é‡ 10ä¸‡+ï¼‰
```
æµè§ˆå™¨ â†’ Nginx (80/443)
         â”œâ”€â”€ /api/*  â†’ Go åç«¯ (8080)
         â””â”€â”€ /*      â†’ é™æ€æ–‡ä»¶ç›®å½•
```

**å‡çº§æ­¥éª¤**:
1. å®‰è£… Nginx
2. é…ç½®åå‘ä»£ç†
3. å°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ° Nginx ç›®å½•
4. å‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹

**Nginx é…ç½®ç¤ºä¾‹**:
```nginx
server {
    listen 80;
    
    # é™æ€æ–‡ä»¶
    location / {
        root /var/www/cutrix/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # API åå‘ä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
    }
}
```

### ç¬¬ä¸‰é˜¶æ®µï¼šå¾®æœåŠ¡æ¶æ„ï¼ˆé€‚åˆå¤§è§„æ¨¡åº”ç”¨ï¼‰
```
æµè§ˆå™¨ â†’ API ç½‘å…³ â†’ å¤šä¸ª Go å¾®æœåŠ¡
                   â”œâ”€â”€ ç”¨æˆ·æœåŠ¡
                   â”œâ”€â”€ è®¢å•æœåŠ¡  
                   â”œâ”€â”€ åº“å­˜æœåŠ¡
                   â””â”€â”€ æ—¥å¿—æœåŠ¡
```

**å‡çº§è¦ç‚¹**:
- æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†æœåŠ¡
- å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—
- å®ç°åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

## ğŸ”§ API ç«¯ç‚¹
åŸºç¡€URL: http://localhost:8080/api

è®¤è¯: POST /api/auth/login

æ¬¾å·: GET, POST /api/styles, GET /api/styles/:id

è®¢å•: GET, POST /api/orders, GET /api/orders/:id

ä»»åŠ¡: GET, POST /api/tasks, GET /api/tasks/:id, GET /api/tasks/progress

å¸ƒåŒ¹: GET, POST /api/fabric-rolls, GET /api/fabric-rolls/:id

æ—¥å¿—: GET, POST /api/production-logs

å‘˜å·¥: GET, POST, PUT, DELETE /api/workers, GET /api/workers/:id/tasks

## ğŸ—„ï¸  æ•°æ®åº“è®¾è®¡ä¸æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
ç³»ç»ŸåŸºäº6å¼ æ ¸å¿ƒè¡¨æ„å»ºï¼š

Styles: äº§å“æ¬¾å·å®šä¹‰ã€‚

Order_Details: åŸå§‹è®¢å•éœ€æ±‚ã€‚

Production_Tasks: ç”Ÿäº§ä»»åŠ¡ï¼ŒåŒ…å«è®¡åˆ’å±‚æ•°å’Œå®é™…å®Œæˆå±‚æ•°ã€‚

Fabric_Rolls: å¸ƒåŒ¹ç‰©æ–™ï¼Œæ¯åŒ¹å¸ƒéƒ½æœ‰å”¯ä¸€ID ([æ¬¾å·]-[é¢œè‰²]-[åºå·])ã€‚

Production_Logs: æ“ä½œçš„å”¯ä¸€çœŸå®æ¥æº (Single Source of Truth)ï¼Œè®°å½•æ”¾æ–™ã€æ‹‰å¸ƒã€è£å‰ªã€æ‰“åŒ…ç­‰æ‰€æœ‰æ“ä½œã€‚

Workers: å‘˜å·¥ä¿¡æ¯ã€‚

å…³é”®ä¸šåŠ¡æµä¸è‡ªåŠ¨åŒ–æœºåˆ¶
è®¡åˆ’: ç®¡ç†å‘˜åˆ›å»º Styles -> å½•å…¥ Order_Details -> ä¸‹è¾¾ Production_Tasksã€‚

ç‰©æ–™å‡†å¤‡: æ³¨å†Œ Fabric_Rollsï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€IDã€‚

æ‰§è¡Œä¸è¿½è¸ª:

å½“å·¥äººå®Œæˆæ‹‰å¸ƒæ“ä½œå¹¶æäº¤ Production_Logs è®°å½•æ—¶ï¼Œæ•°æ®åº“è§¦å‘å™¨ trg_after_spreading_log_insert ä¼šè‡ªåŠ¨æ›´æ–° Production_Tasks è¡¨ä¸­å¯¹åº”ä»»åŠ¡çš„ completed_layers å­—æ®µã€‚

ä¸¥ç¦åœ¨åº”ç”¨ä»£ç ä¸­æ‰‹åŠ¨ä¿®æ”¹ completed_layersã€‚æ‰€æœ‰è¿›åº¦æ›´æ–°éƒ½æºäº Production_Logs çš„æ’å…¥ã€‚

è£å‰ªã€æ‰“åŒ…ç­‰åç»­å·¥åºé€šè¿‡ parent_log_id å½¢æˆè¿½è¸ªé“¾ã€‚


## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tlnp | grep 8080
   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
   ```

2. **å‰ç«¯æ„å»ºå¤±è´¥**
   ```bash
   # æ¸…ç†ä¾èµ–é‡æ–°å®‰è£…
   cd web-frontend
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€
   docker-compose ps
   # æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
   docker-compose logs postgres
   ```